---

- name: be sure required packages are installed
  become: yes
  yum:
     name: '{{item}}'
     state: latest
  with_items:
     - python
     - python-devel
     - python-setuptools
     - python-pip
     - sip
     - sip-devel
     - qt
     - qt-devel
     - PyQt4

- name: install python packages
  become : yes
  pip:
    name: "{{item}}"
    state: forcereinstall
    extra_args: "--proxy={{ http_proxy }}"
  with_items:
    - pip
    - setuptools
    - numpy
    - kafka-python
    - pyepics
    - flatbuffers

- name: remove some requirements
  become: yes
  lineinfile:
    destfile: '{{ nicos_src_dir }}/requirements.txt'
    regexp: '^(.*){{item}}(.*)'
    line: '# {{item}}'
  with_items:
    - nicoslivewidget
    - mysql-connector-python-rf

- name: install python requirements
  become: yes
  pip:
    state: latest
    requirements: '{{ nicos_src_dir }}/requirements.txt'
    extra_args: "--proxy={{ http_proxy }}"
